---
title: 前端包管理器的发展
date: 2017-12-08 11:53:43
tags: 前端
---

## 前言
我们在开发时，会用到很多开发者写的第三方库。如果我们要使用别人写的某个包，每次都根据名称搜索一下官方网站，下载代码，解压，再使用，非常繁琐。 
于是一个集中管理的工具应运而生：大家都把自己开发的模块打包后放到一个包管理器的平台上，如果要使用，直接通过包管理器安装就可以直接用，不用管代码存在哪，应该从哪下载。


因此使用包管理器主要基于以下几个原因：

1. 方便的寻找和下载你需要的依赖库，并将它们整合到项目中，例如`jQuery`,`Angular`等。
2. 方便的下载指定版本的依赖库（免除去网络上搜索和下载）
3. **解决第三方库之间的依赖关系**



## Bower

由`twitter`推出的包管理工具。基于nodejs的模块化思想,把功能分散到各个模块中，让模块和模块之间存在联系,通过 Bower 来管理模块间的这种联系。它的特点是对包结构没有强制规范，即依赖扁平。

但`Bower`本身不存储模块文件本身，也不保存模块的版本信息。模块的发布者通过注册（register）的方式，将模块的可访问的公开的git地址记录在bower的数据库中。而所有的版本都是通过模块发布者自己控制代码库的tag来决定。

`Bower`在安装流程基本上可以简单认为是将注册的git地址中的特定tag clone一份到你本地的bower_components 目录中。


`Bower`本身也存在很多问题,也是导致频临淘汰的原因:
1. 数据源的问题,`Bower` 直接取 `github` 而缺少像 `npm` 那样的 `registry`，导致一个问题，`github上`放的是源码，和部署所需是不同的，这导致使用上的问题，对于开发者而言,还需要专门开个分支整理出一个适合使用者的源码.
2. 缺乏构建工具
3. 源数据问题

--- 

## NPM

`npm`(node package manager)有两层含义。一层含义是Node的开放式模块登记平台和管理系统，网址为npmjs.org。另一层含义是Node默认的模块管理器，是一个命令行下的软件，用来安装和管理Node模块。

`npm`不需要单独安装。在安装Node的时候，会连带一起安装npm。
同时也是目前开发者中使用率最高的包管理器
但是，Node附带的npm可能不是最新版本，最好用下面的命令，更新到最新版本。


`NPM`较之`Bower`,具有一个独立的服务器网站用来存放开发者的库文件,且在处理库与库之间的依赖关系上更强.


### CNPM
因为`npm`的服务器是在国外,所以被墙是经常的,这是就要介绍一下比较良心的`cnpm`了.
CNPM即是[淘宝镜像源](https://npm.taobao.org/),这是一个完整  [npmjs.org](http://npmjs.org) 镜像，用此代替官方版本(只读)，同步频率目前为 10分钟 一次以保证尽量与官方服务同步。

使用`cnpm`后,`install`的速度可比`cnpm`快得多了。


---

## Yarn
facebook发布的新一代包管理工具，旨在解决以往使用npm作为包管理会遇到的一些问题。从其官方介绍可以看到其重点强调的3个点：快、可靠、安全。

### yarn的优势
相比于`Node`的亲儿子`npm`来说，`yarn`有以下优势:

1、安装模块速度更快
![](http://7tszky.com1.z0.glb.clouddn.com/FifXFXX6rNLMtwA5xuvB85DzDL0M)


2、支持离线模式(只要你安装过此模块，第二次安装就会从缓存文件中直接复制过来)
`yarn`会有一个缓存目录，会缓存以前安装过的软件包，再次安装时就不必从网络下载了，大大加速安装速度。
这一点很重要，`npm` 饱受诟病的一点就是，每次安装依赖，都需要从网络下载一大堆东西，而且是全部重新下载，工程多的时候比较烦人。


3、依赖关系确定性.
在每一台机器上针对同一个工程安装依赖时，生成的依赖关系顺序和版本是一致的。
之前 npm 在这里有一个处理得不好的地方 。举例来说，我写的工程依赖 A, B, C 三个库，我在编写 package.json 的时候，给 A, B, C 都指定了版本号。但是 A 库可能又依赖 D, E, F 库，D 库又依赖 G, H 库。这么多关联依赖关系中，**很可能某个库在指定依赖时，没有指定版本号**。
于是，这就导致了一个问题。如果我在另一台机器上对同样的工程安装依赖，或者把这台机器工程下的 node_modules 目录删除来重新安装依赖。由于关联依赖中，没有指定版本号的库，发生了版本更新，就会导致再次安装的依赖，其中具体某些软件包的版本是不一致的。在这种情况下，你会发现原来能够正常运行的程序，忽然变得不能工作或一堆 BUG.

而`yarn`在解析package.json文件时，会对其每个依赖包进行遍历分析生成yarn.lock文件。该文件描述了项目中每个包以及每个包中所依赖的包的版本信息。

4.迁移方便
目前`npm`的项目迁移至`yarn`,基本是无痛迁移,可以很方便的就切换.
--- 
### yarn & npm 常用命令比较


- npm install === yarn / yarn install
- npm install xxx —save === yarn add xxx
- npm uninstall xxx —save === yarn remove xxx
- npm install xxx —save-dev === yarn add xxx —dev
- npm update === yarn upgrade
- npm install xxx -g === yarn global add xxx
当然，在比较选择`yarn`与`npm`时，速度也是一个很重要的衡量指标。



--- 
### Yarn总结
yarn 相比 npm 最直观优势就是快
目前项目在基本可以无痛迁移使用。
yarn 目前并不是非常稳定，不少反馈script run以及下载包有问题。
lock功能具有双面性，是否锁定版本需要看具体情况而定
